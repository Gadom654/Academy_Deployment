locals {
  #VNET
  vnet_name          = "${var.prefix}-vnet"
  vnet_address_space = ["10.0.0.0/16"]
  #SUBNETS
  private_subnet_1_name                   = "${var.prefix}-AKS-private-subnet"
  private_subnet_1_address_space          = ["10.0.0.0/24"]
  private_subnet_2_name                   = "${var.prefix}-DB-private-subnet"
  private_subnet_2_address_space          = ["10.0.1.0/24"]
  public_subnet_1_name                    = "${var.prefix}-AppGateway-public-subnet"
  public_subnet_1_address_space           = ["10.0.2.0/24"]
  public_subnet_2_name                    = "AzureBastionSubnet"
  public_subnet_2_address_space           = ["10.0.3.0/24"]
  private_subnets_outbound_access_enabled = false
  private_subnet_2_service_delegation     = "Microsoft.DBforPostgreSQL/flexibleServers"
  private_subnet_2_delegated_actions      = "Microsoft.Network/virtualNetworks/subnets/join/action"
  private_subnet_2_delegation_name        = "${var.prefix}-private-subnet-2-delegation"
  #NAT_GATEWAY
  nat_gateway_name                 = "${var.prefix}-nat-gateway"
  nat_gateway_ip_name              = "${var.prefix}-nat-gateway-pip"
  nat_gateway_ip_allocation_method = "Static"
  nat_gateway_sku_standard         = "Standard"
  #DNS_ZONE
  dns_vnet_link_name1    = "${var.prefix}-dns-vnet-link1"
  dns_vnet_link_name2    = "${var.prefix}-dns-vnet-link2"
  isregistration_enabled = false
  a_dns_record_name      = "*"
  ttl_value              = 300
  #NSG
  nsg-app-gateway_name                               = "app-gateway-nsg"
  nsg-app-gateway_rule_1_name                        = "AllowHTTP_HTTPS"
  nsg-app-gateway_rule_1_priority                    = 100
  nsg-app-gateway_rule_1_direction                   = "Inbound"
  nsg-app-gateway_rule_1_access                      = "Allow"
  nsg-app-gateway_rule_1_protocol                    = "Tcp"
  nsg-app-gateway_rule_1_source_port_range           = "*"
  nsg-app-gateway_rule_1_destination_port_range      = ["80", "443"]
  nsg-app-gateway_rule_1_source_address_prefix       = "Internet"
  nsg-app-gateway_rule_1_destination_address_prefix  = "*"
  nsg-app-gateway_rule_2_name                        = "AllowGatewayManager"
  nsg-app-gateway_rule_2_priority                    = 110
  nsg-app-gateway_rule_2_direction                   = "Inbound"
  nsg-app-gateway_rule_2_access                      = "Allow"
  nsg-app-gateway_rule_2_protocol                    = "Tcp"
  nsg-app-gateway_rule_2_source_port_range           = "*"
  nsg-app-gateway_rule_2_destination_port_range      = "65200-65535"
  nsg-app-gateway_rule_2_source_address_prefix       = "GatewayManager"
  nsg-app-gateway_rule_2_destination_address_prefix  = "*"
  nsg-aks-name                                       = "aks-nsg"
  nsg-aks-rule-1_name                                = "AllowAppGateway"
  nsg-aks-rule-1_priority                            = 100
  nsg-aks-rule-1_direction                           = "Inbound"
  nsg-aks-rule-1_access                              = "Allow"
  nsg-aks-rule-1_protocol                            = "Tcp"
  nsg-aks-rule-1_source_port_range                   = "*"
  nsg-aks-rule-1_destination_port_range              = ["8080"]
  nsg-aks-rule-1_source_address_prefix               = local.public_subnet_1_address_space[0]
  nsg-aks-rule-1_destination_address_prefix          = "*"
  nsg-db-name                                        = "db-nsg"
  nsg-db-name-rule-1_name                            = "AllowAKS_Postgres"
  nsg-db-name-rule-1_priority                        = 100
  nsg-db-name-rule-1_direction                       = "Inbound"
  nsg-db-name-rule-1_access                          = "Allow"
  nsg-db-name-rule-1_protocol                        = "Tcp"
  nsg-db-name-rule-1_source_port_range               = "*"
  nsg-db-name-rule-1_destination_port_range          = ["5432"]
  nsg-db-name-rule-1_source_address_prefix           = local.private_subnet_1_address_space[0]
  nsg-db-name-rule-1_destination_address_prefix      = "*"
  nsg-bastion-name                                   = "bastion-nsg"
  nsg-bastion-name-rule-1_name                       = "AllowSshRdpOutbound"
  nsg-bastion-name-rule-1_priority                   = 100
  nsg-bastion-name-rule-1_direction                  = "Outbound"
  nsg-bastion-name-rule-1_access                     = "Allow"
  nsg-bastion-name-rule-1_protocol                   = "*"
  nsg-bastion-name-rule-1_source_port_range          = "*"
  nsg-bastion-name-rule-1_destination_port_range     = ["22", "3389"]
  nsg-bastion-name-rule-1_source_address_prefix      = "*"
  nsg-bastion-name-rule-1_destination_address_prefix = "VirtualNetwork"
  nsg-bastion-name-rule-2_name                       = "AllowAzureCloudOutbound"
  nsg-bastion-name-rule-2_priority                   = 110
  nsg-bastion-name-rule-2_direction                  = "Outbound"
  nsg-bastion-name-rule-2_access                     = "Allow"
  nsg-bastion-name-rule-2_protocol                   = "Tcp"
  nsg-bastion-name-rule-2_source_port_range          = "*"
  nsg-bastion-name-rule-2_destination_port_range     = "443"
  nsg-bastion-name-rule-2_source_address_prefix      = "*"
  nsg-bastion-name-rule-2_destination_address_prefix = "AzureCloud"
  nsg-bastion-name-rule-3_name                       = "AllowHttpsInbound"
  nsg-bastion-name-rule-3_priority                   = 120
  nsg-bastion-name-rule-3_direction                  = "Inbound"
  nsg-bastion-name-rule-3_access                     = "Allow"
  nsg-bastion-name-rule-3_protocol                   = "Tcp"
  nsg-bastion-name-rule-3_source_port_range          = "*"
  nsg-bastion-name-rule-3_destination_port_range     = ["443"]
  nsg-bastion-name-rule-3_source_address_prefix      = "Internet"
  nsg-bastion-name-rule-3_destination_address_prefix = "*"
  nsg-bastion-name-rule-4_name                       = "AllowGatewayManagerInbound"
  nsg-bastion-name-rule-4_priority                   = 130
  nsg-bastion-name-rule-4_direction                  = "Inbound"
  nsg-bastion-name-rule-4_access                     = "Allow"
  nsg-bastion-name-rule-4_protocol                   = "Tcp"
  nsg-bastion-name-rule-4_source_port_range          = "*"
  nsg-bastion-name-rule-4_destination_port_range     = "443"
  nsg-bastion-name-rule-4_source_address_prefix      = "GatewayManager"
  nsg-bastion-name-rule-4_destination_address_prefix = "*"
}
